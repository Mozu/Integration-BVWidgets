define("pages/myaccount",["modules/backbone-mozu","hyprlive","hyprlivecontext","modules/jquery-mozu","underscore","modules/models-customer","modules/views-paging"],function(t,e,n,i,d,a,r){var o=t.MozuView.extend({constructor:function(){t.MozuView.apply(this,arguments),this.editing={}},getRenderContext:function(){var e=t.MozuView.prototype.getRenderContext.apply(this,arguments);return e.editing=this.editing,e},doModelAction:function(t,e){var n=this,i=function(){n.render()},d=this.model[t](e);return d&&d.then?(d.then(i,i),d):void 0}}),s=o.extend({templateName:"modules/my-account/my-account-settings",autoUpdate:["firstName","lastName","oldPassword","password","confirmPassword","acceptsMarketing"],updateAcceptsMarketing:function(t){var e=i(t.currentTarget).prop("checked");this.model.set("acceptsMarketing",e),this.model.updateAcceptsMarketing(e)},startEditName:function(){this.editing.name=!0,this.render()},cancelEditName:function(){this.editing.name=!1,this.render()},finishEditName:function(){var t=this;this.doModelAction("updateName").otherwise(function(){t.editing.name=!0}),this.editing.name=!1},startEditPassword:function(){this.editing.password=!0,this.render()},finishEditPassword:function(){var t=this;this.doModelAction("changePassword").then(function(){d.delay(function(){t.$('[data-mz-validationmessage-for="passwordChanged"]').show().text(e.getLabel("passwordChanged")).fadeOut(3e3)},250)},function(){t.editing.password=!0}),this.editing.password=!1},cancelEditPassword:function(){this.editing.password=!1,this.render()}}),c=o.extend({templateName:"modules/my-account/my-account-wishlist",addItemToCart:function(t){var e=i(t.currentTarget),n=e.data("mzItemId");return n?(this.editing.added=n,this.doModelAction("addItemToCart",n)):void 0},doNotRemove:function(){this.editing.added=!1,this.editing.remove=!1,this.render()},beginRemoveItem:function(t){var e=i(t.currentTarget).data("mzItemId");e&&(this.editing.remove=e,this.render())},finishRemoveItem:function(t){var e=this,n=i(t.currentTarget).data("mzItemId");if(n){var d=n;return this.model.apiDeleteItem(n).then(function(){e.editing.remove=!1;var t=e.model.get("items").where({id:d});t&&(e.model.get("items").remove(t),e.render())})}}}),m=t.MozuView.extend({templateName:"modules/my-account/order-history-list",autoUpdate:["rma.returnType","rma.reason","rma.quantity","rma.comments"],initialize:function(){this.listenTo(this.model,"change:pageSize",d.bind(this.model.changePageSize,this.model))},getRenderContext:function(){var e=t.MozuView.prototype.getRenderContext.apply(this,arguments);return e.returning=this.returning,e},startReturnItem:function(t){var e=i(t.currentTarget),n=e.data("mzStartReturn"),d=e.data("mzOrderId");n&&d&&(this.returning=n,this.model.startReturn(d,n)),this.render()},cancelReturnItem:function(){delete this.returning,this.model.clearReturn(),this.render()},finishReturnItem:function(){var t=this,e=this.model.finishReturn();return e?e.then(function(){delete t.returning,t.render()}):void 0}}),g=t.MozuView.extend({templateName:"modules/my-account/return-history-list",initialize:function(){var t=this;this.listenTo(this.model,"change:pageSize",d.bind(this.model.changePageSize,this.model)),this.listenTo(this.model,"returndisplayed",function(e){var n=t.$('[data-mz-id="'+e+'"]');0===n.length&&(n=t.$el),n.ScrollTo({axis:"y"})})}}),u=o.extend({templateName:"modules/my-account/my-account-paymentmethods",autoUpdate:["editingCard.paymentOrCardType","editingCard.nameOnCard","editingCard.cardNumberPartOrMask","editingCard.expireMonth","editingCard.expireYear","editingCard.cvv","editingCard.isCvvOptional","editingCard.contactId","editingContact.firstName","editingContact.lastNameOrSurname","editingContact.address.address1","editingContact.address.address2","editingContact.address.address3","editingContact.address.cityOrTown","editingContact.address.countryCode","editingContact.address.stateOrProvince","editingContact.address.postalOrZipCode","editingContact.address.addressType","editingContact.phoneNumbers.home","editingContact.isBillingContact","editingContact.isPrimaryBillingContact","editingContact.isShippingContact","editingContact.isPrimaryShippingContact"],renderOnChange:["editingCard.contactId","editingContact.address.countryCode"],beginEditCard:function(t){var e=this.editing.card=t.currentTarget.getAttribute("data-mz-card");this.model.beginEditCard(e),this.render()},finishEditCard:function(){var t=this,e=this.doModelAction("saveCard");e&&(e.otherwise(function(){t.editing.card=!0}),this.editing.card=!1)},cancelEditCard:function(){this.editing.card=!1,this.model.endEditCard(),this.render()},beginDeleteCard:function(t){var n=t.currentTarget.getAttribute("data-mz-card"),i=this.model.get("cards").get(n);window.confirm(e.getLabel("confirmDeleteCard",i.get("cardNumberPart")))&&this.doModelAction("deleteCard",n)}}),l=o.extend({templateName:"modules/my-account/my-account-addressbook",autoUpdate:["editingContact.firstName","editingContact.lastNameOrSurname","editingContact.address.address1","editingContact.address.address2","editingContact.address.address3","editingContact.address.cityOrTown","editingContact.address.countryCode","editingContact.address.stateOrProvince","editingContact.address.postalOrZipCode","editingContact.address.addressType","editingContact.phoneNumbers.home","editingContact.isBillingContact","editingContact.isPrimaryBillingContact","editingContact.isShippingContact","editingContact.isPrimaryShippingContact"],renderOnChange:["editingContact.address.countryCode","editingContact.isBillingContact","editingContact.isShippingContact"],beginAddContact:function(){this.editing.contact="new",this.render()},beginEditContact:function(t){var e=this.editing.contact=t.currentTarget.getAttribute("data-mz-contact");this.model.beginEditContact(e),this.render()},finishEditContact:function(){var t=this,e=n.locals.siteContext.generalSettings.isAddressValidationEnabled,i=this.doModelAction("saveContact",{forceIsValid:e});i&&(i.otherwise(function(){t.editing.contact=!0}),this.editing.contact=!1)},cancelEditContact:function(){this.editing.contact=!1,this.model.endEditContact(),this.render()},beginDeleteContact:function(t){var n=this,i=this.model.get("contacts").get(t.currentTarget.getAttribute("data-mz-contact")),a=this.model.get("cards").where({contactId:i.id}),r=e.getLabel("confirmDeleteContact",i.get("address").get("address1")),o=function(){return n.doModelAction("deleteContact",i.id)},s=o;return a.length>0&&(r+=" "+e.getLabel("confirmDeleteContact2"),s=function(){return n.doModelAction("deleteMultipleCards",d.pluck(a,"id")).then(o)}),window.confirm(r)?s():void 0}}),h=t.MozuView.extend({templateName:"modules/my-account/my-account-storecredit",addStoreCredit:function(){var t=this,e=this.$("[data-mz-entering-credit]").val();return e?this.model.addStoreCredit(e).then(function(){return t.model.getStoreCredits()}):void 0}});i(document).ready(function(){var t=window.accountModel=a.EditableCustomer.fromCurrent(),n=i("#account-settings"),o=i("#account-orderhistory"),C=i("#account-returnhistory"),p=i("#account-paymentmethods"),f=i("#account-addressbook"),y=i("#account-wishlist"),w=i("#account-messages"),v=i("#account-storecredit"),b=t.get("orderHistory"),z=t.get("returnHistory"),N=window.accountViews={settings:new s({el:n,model:t,messagesEl:w}),orderHistory:new m({el:o.find("[data-mz-orderlist]"),model:b}),orderHistoryPagingControls:new r.PagingControls({templateName:"modules/my-account/order-history-paging-controls",el:o.find("[data-mz-pagingcontrols]"),model:b}),orderHistoryPageNumbers:new r.PageNumbers({el:o.find("[data-mz-pagenumbers]"),model:b}),returnHistory:new g({el:C.find("[data-mz-orderlist]"),model:z}),returnHistoryPagingControls:new r.PagingControls({templateName:"modules/my-account/order-history-paging-controls",el:C.find("[data-mz-pagingcontrols]"),model:z}),returnHistoryPageNumbers:new r.PageNumbers({el:C.find("[data-mz-pagenumbers]"),model:z}),paymentMethods:new u({el:p,model:t,messagesEl:w}),addressBook:new l({el:f,model:t,messagesEl:w}),storeCredit:new h({el:v,model:t,messagesEl:w})};e.getThemeSetting("allowWishlist")&&(N.wishList=new c({el:y,model:t.get("wishlist"),messagesEl:w})),d.invoke(window.accountViews,"render")})});