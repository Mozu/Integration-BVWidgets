define("modules/models-cart",["underscore","modules/backbone-mozu","hyprlive"],function(e,t,n){var i=t.MozuModel.extend({helpers:["mainImage"],mainImage:function(){var e=this.get("productImages"),t=e&&e[0],i="http://placehold.it/160&text="+n.getLabel("noImages");return t||{ImageUrl:i,imageUrl:i}},initialize:function(){var e="/product/"+this.get("productCode");this.set({Url:e,url:e})}}),o=t.MozuModel.extend({relations:{product:i},validation:{quantity:{min:1}},dataTypes:{quantity:t.MozuModel.DataTypes.Int},mozuType:"cartitem",handlesMessages:!0,helpers:["priceIsModified"],priceIsModified:function(){var e=this.get("unitPrice");return e.baseAmount!=e.discountedAmount},saveQuantity:function(){this.hasChanged("quantity")&&this.apiUpdateQuantity(this.get("quantity"))}}),a=t.MozuModel.extend({mozuType:"cart",handlesMessages:!0,helpers:["isEmpty","count"],relations:{items:t.Collection.extend({model:o})},initialize:function(){this.get("items").on("sync remove",this.fetch,this).on("loadingchange",this.isLoading,this)},isEmpty:function(){return this.get("items").length<1},count:function(){return this.apiModel.count()},toOrder:function(){var e=this;e.apiCheckout().then(function(t){e.trigger("ordercreated",t)})},removeItem:function(e){var t=this;this.get("items").get(e).apiModel.del().then(function(){return t.fetch()})}});return{CartItem:o,Cart:a}}),define("pages/cart",["modules/backbone-mozu","underscore","modules/jquery-mozu","modules/models-cart","modules/cart-monitor"],function(e,t,n,i,o){var a=e.MozuView.extend({templateName:"modules/cart/cart-table",updateQuantity:t.debounce(function(e){var t=n(e.currentTarget),i=parseInt(t.val()),o=t.data("mz-cart-item"),a=this.model.get("items").get(o);a&&!isNaN(i)&&(a.set("quantity",i),a.saveQuantity())},400),removeItem:function(e){var t=n(e.currentTarget),i=t.data("mz-cart-item");return this.model.removeItem(i),!1},proceedToCheckout:function(){this.model.isLoading(!0)}});n(document).ready(function(){var e=i.Cart.fromCurrent(),t=new a({el:n("#cart"),model:e,messagesEl:n("[data-mz-message-bar]")});e.on("ordercreated",function(t){e.isLoading(!0),window.location="/checkout/"+t.prop("id")}),e.on("sync",function(){o.setCount(e.count())}),window.cartView=t})});