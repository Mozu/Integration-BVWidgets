define(["modules/jquery-mozu","underscore","modules/api","modules/backbone-mozu","modules/models-product"],function(e,t,o,n,d){e(function(){e("[data-mz-deal-of-the-day]").each(function(u,a){a=e(a);var r,i,c=a.data("mzDealOfTheDay");r=o.get("search",{filter:"discountId eq "+c.discountId,pageSize:"product"===c.displayStyle?1:20}),i=n.MozuView.extend({templateName:"modules/product/product-list",getRenderContext:function(){var e=n.MozuView.prototype.getRenderContext.apply(this,arguments);return e.dealOfTheDay=c,e}}),r.then(function(e){var o,n,u=e.data;if(u.items=t.filter(u.items,function(e){var t=e.price.discount;return t&&t.discount.discountId===c.discountId}),u.totalCount=u.items.length,o=new d.ProductCollection(u),0===o.attributes.totalCount)throw"Deal of the Day: there are no products to show for the selected discount.";n=new i({model:o,el:a}),n.render()})})})});