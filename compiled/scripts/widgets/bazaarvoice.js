require(["modules/jquery-mozu","hyprlive","modules/backbone-mozu","modules/models-product","modules/api","modules/models-orders"],function(t,e,i,n,o,a){t(document).ready(function(){var e=o.get("entityList",{listName:"bvsettings@mzint",id:o.context.site});e.then(function(e){var i=e.data.items[0],r="-stg";"Staging"!=i.environment&&(r="");var l=1==t("#bvProductDetail").val(),c=1==t("#bvROIWidget").val(),u=1==t("#containerPage").val(),d=i.deploymentZone,s=o.context.locale.replace("-","_"),m="//display"+r+".ugc.bazaarvoice.com/static/"+i.clientName+"/"+d+"/"+s+"/bvapi.js";t.getScript(m).done(function(){if(l){var e=n.Product.fromCurrent();$BV.configure("global",{productId:e.id});var i=(t("[data-mz-bv-config]").data("mzBvConfig").tabCode,t("[data-mz-bv-config]").data("mzBvConfig").widgetType);$BV.ui("rr","show_reviews",{doShowContent:function(){"summary"==i&&showReviewSummary()}}),$BV.ui("qa","show_questions",{doShowContent:function(){}})}else if(c){var o=a.Order.fromCurrent().attributes,r={};r.orderId=o.orderNumber,r.tax=o.taxTotal,r.shipping=o.shippingTotal,r.total=o.total,r.city=o.billingInfo.billingContact.address.cityOrTown,r.state=o.billingInfo.billingContact.address.stateOrProvince,r.country=o.billingInfo.billingContact.address.countryCode,r.currency=o.currencyCode,r.email=o.email,r.locale=s;var d={};null!==o.fulfillmentInfo&&null!==o.fulfillmentInfo.fulfillmentContact?(d=o.fulfillmentInfo.fulfillmentContact.address,r.nickname=o.fulfillmentInfo.fulfillmentContact.firstName):(d=o.billingInfo.billingContact.address,r.nickname=o.billingInfo.billingContact.firstName),r.city=d.cityOrTown,r.state=d.stateOrProvince,r.country=d.countryCode;for(var m=[],f={},g=0;g<o.items.models.length;g++){var b=o.items.models[g].attributes;f.sku=b.product.attributes.productCode,f.name=b.product.attributes.name,b.product.attributes.categories.length>0&&(f.category=b.product.attributes.categories[0].id,f.price=b.total),f.quantity=b.quantity,null!==b.product.attributes.imageUrl&&(f.imageURL=b.product.attributes.imageUrl),m[g]=f}r.items=m,$BV.SI.trackTransactionPageView(r)}else u&&$BV.container("global",{});var v={};if(t(".bvr-inline-rating").each(function(){var e=t(this),i=e.data("mzProductCode");v[i]={url:e.data("mzProductUrl"),containerId:e.attr("id")}}),!jQuery.isEmptyObject(v)){var p={};p.productIds=v,p.containerPrefix="BVRRInlineRating",$BV.ui("rr","inline_ratings",p)}}).fail(function(t){console.log(t)})})})});