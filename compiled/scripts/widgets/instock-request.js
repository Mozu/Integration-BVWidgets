define(["modules/jquery-mozu","hyprlive","underscore","modules/api","modules/backbone-mozu","modules/models-product"],function(e,t,o,r,n,i){function a(){return(e.cookie("mozustocknotify")||"").split(",")}function d(t){var o=a();e.cookie("mozustocknotify",o.concat(t).join(","),{path:"/",expires:365})}var s=require.mozuData("user"),u=n.MozuView.extend({templateName:"modules/product/product-instock-request",clearError:function(){this.setError("")},setError:function(e){this.$("[data-mz-validationmessage-for]").text(e)},getRenderContext:function(){var e=n.MozuView.prototype.getRenderContext.apply(this,arguments);return e.subscribed=-1!==o.indexOf(a(),this.model.get("variationProductCode")||this.model.get("productCode")),e},render:function(){n.MozuView.prototype.render.apply(this,arguments);var t=this.model.get("inventoryInfo");this.$el.css("display",t&&"onlineStockAvailable"in t&&0===t.onlineStockAvailable||e("body").hasClass("mz-cms-editing")?"inherit":"none")},widgetNotifyUserAction:function(){var e=this;this.clearError();var o=this.$('[data-mz-role="email"]').val()||s.email;return o?(r.create("instockrequest",{email:o,customerId:s.accountId,productCode:this.model.get("productCode"),locationCode:this.model.get("inventoryInfo").onlineLocationCode}).then(function(){d(e.model.get("variationProductCode")||e.model.get("productCode")),e.render()},function(){e.setError(t.getLabel("notifyWidgetError"))}),void 0):(this.setError(t.getLabel("emailMissing")),!1)}});e(document).ready(function(){var t=i.Product.fromCurrent();r.on("sync",function(e){"product"===e.type&&(t.set(e.data),t.trigger("sync",e.data))}),e("[data-mz-instock-request]").each(function(){var o=e(this),r=o.data("mzInstockRequest"),n={model:t,el:o};r.template&&(n.template=r.template),new u(n).render()})})});